<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScholarZone Profile</title>
    <link rel="stylesheet" href="../css/account-details.css">
</head>
<body>
    <div class="sidebar" id="sidebar">
        <div class="logo">
            <img src="../pictures/scholarzone-logo.png" class="close1" id="close1">
            <span class="logo-text">
                <span class="logo-scholar">Scholar</span><span class="logo-zone">Zone</span>
            </span>
        </div>
        <div class="nav-item">
            <a href="dashboard.html" class="nav-link">
                <img src="../pictures/dashboard_icon.png" alt="Dashboard" class="nav-icon">
                Dashboard
            </a>
        </div>
        <div class="nav-item">
            <a href="create.html" class="nav-link">
                <img src="../pictures/create_icon.png" alt="Create" class="nav-icon">
                Create
            </a>
        </div>
        <div class="nav-item">
            <a href="manage.html" class="nav-link">
                <img src="../pictures/manage_icon.png" alt="Manage" class="nav-icon">
                Manage
            </a>
        </div>
        <div class="nav-item">
            <a href="review.html" class="nav-link">
                <img src="../pictures/review_icon.png" alt="Review" class="nav-icon">
                Review
            </a>
        </div>
    </div>

    <div class="main-content">
        <div class="header">
            <div class="menu-toggle" id="menu-toggle">â˜°</div>
            <div class="user-profile">
                <div class="username-container">
                    <span id="username">@janedoe69</span>
                    <img src="../pictures/avatar-icon.png" alt="User" id="avatar-icon" class="avatar-icon" onclick="">
                    <div class="hover-profile" id="hover-profile">
                        <ul>
                            <li><a href="settings.html">Edit Profile Picture</a></li>
                            <li><a href="#">Personal Details</a></li>
                            <li><a href="#">Account Details</a></li>
                            <li><a href="#" style="color: red;">Log Out</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div class="align-content">
            <div class="back-button">
                <img src="../pictures/backbtn-icon.png" id="back-button">
            </div>
            
            <h1 class="create-title">Account Details</h1>
            
            <div class="form-container">
                <div class="form-group">
                    <label>Username</label>
                    <div class="input-container">
                        <input type="text" class="editable-input" value="Jane" readonly>
                        <img src="../pictures/edit-icon.png" class="edit-icon" alt="Edit Icon">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Password</label>
                    <div class="input-container">
                        <input type="text" class="editable-input" value="********" readonly>
                        <img src="../pictures/edit-icon.png" class="edit-icon" alt="Edit Icon">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Email Address</label>
                    <div class="input-container">
                        <input type="text" class="editable-input" value="jane.doe@example.com" readonly>
                        <img src="../pictures/edit-icon.png" class="edit-icon" alt="Edit Icon">
                    </div>
                </div>
            </div>
        </div>
      </div>

      <script>
        document.addEventListener("DOMContentLoaded", async function () {
            const storedId = localStorage.getItem("id");
            const avatarIcon = document.getElementById("avatar-icon");
            const hoverProfile = document.getElementById("hover-profile");
            const menuToggle = document.getElementById("menu-toggle");
            const sidebar = document.getElementById("sidebar");

            if (!storedId) {
                console.error("No ID found in localStorage.");
                return;
            }

            const editIcons = document.querySelectorAll(".edit-icon");
            editIcons.forEach((icon, index) => {
                icon.addEventListener("click", function () {
                    const inputField = icon.previousElementSibling;
                    inputField.value = "";
                    inputField.removeAttribute("readonly");
                    inputField.focus();
                });
            });

            try {
                let response = await fetch(`https://active-fox-exactly.ngrok-free.app/ScholarZone/api/reviewers?id=${storedId}&ngrok-skip-browser-warning=true`, {
                method: "GET",
                headers: {
                    "Content-Type": "application/json",
                    "ngrok-skip-browser-warning": "true"
                }
            });

            let rawText = await response.text();

            let data;
            try {
                data = JSON.parse(rawText); 
                console.log("Parsed API Response:", data);
            } catch (jsonError) {
                console.error("JSON Parsing Error. API returned HTML or invalid JSON:", jsonError);
                return;
            }

            if (data.status === 200) {
                const user = data.data;
                console.log("User Data:", user);

                const usernameElement = document.getElementById("username");
                if (usernameElement) {
                    usernameElement.textContent = "@" + user.username;
                } else {
                    console.error("Element with ID 'username' not found.");
                }
            } else {
                console.error("API returned error:", data.message);
            }
        
            } catch (error) {
                console.error("Fetch Request Failed:", error);
            }

            avatarIcon.addEventListener("click", function (event) {
                hoverProfile.classList.toggle("show");
                event.stopPropagation();
            });

            menuToggle.addEventListener("click", function () {
                sidebar.classList.toggle("show");
            });

            const closeBtn = document.getElementById("close1");
            closeBtn.addEventListener("click", function () {
                sidebar.classList.remove("show");
            });

            document.addEventListener("click", function (event) {
                if (!hoverProfile.contains(event.target) && event.target !== avatarIcon) {
                    hoverProfile.classList.remove("show");
                }

                if (!sidebar.contains(event.target) && event.target !== menuToggle) {
                    sidebar.classList.remove("show");
                }
            });
        });
      </script>
  </body>
</html>