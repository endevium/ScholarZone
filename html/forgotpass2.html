<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScholarZone - Forgot Password</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.2.0/remixicon.css">
    <link rel="stylesheet" href="../css/forgotpass2.css">
</head>

<body>
    <header>
        <nav class="navbar">
            <div class="nav-left">
                <label class="open_menu" id="menu-toggle"><i class="ri-menu-line"></i></label>
                <div class="logo"><a href="landing.html"><b>Scholar</b><span>Zone</span></a></div>
                <ul class="menudo" id="menu">
                    <li><a href="landing.html"> Home </a></li>
                    <li><a href="landing.html#feature-section"> Student </a></li>
                    <li><a href="landing.html#review-section"> Reviewer </a></li>
                    <li><a href="login.html" class="menu-login"> Log in </a></li>
                    <li><a href="signup1.html" class="menu-signup"> Sign up </a></li>
                    <label class="close_menu"><i class="ri-close-line"></i></label>
                </ul>
            </div>
            <div class="nav-right">
                <button class="log"><a href="login.html"> Log In </a></button>
                <button class="sign"><a href="signup1.html"> Sign Up </a></button>
            </div>
        </nav>
    </header>

    <div class="container">
        <div class="malakingFPassword">
            <h1>Forgot password?</h1>

            <div class="progress">
                <span></span>
                <span class="active"></span>
                
            </div>

            <p>Create a new password</p>

            <form action="#" method="POST">
                <div class="input-container">
                    <label for="otp"><b>One-Time PIN</b></label>
                    <div class="input-box">
                        <input type="number" id="otp" name="otp" placeholder="123456" max="999999" required>
                    </div>
                </div>

                <div class="input-container">
                    <label for="new-password"><b>New Password</b></label>
                    <div class="input-box">
                        <i class="ri-lock-password-line"></i>
                        <input type="password" id="new-password" name="new-password" placeholder="********" required>
                        <i class="ri-eye-line toggle-password"></i>
                    </div>
                </div>

                <div class="input-container">
                    <label for="confirm-password"><b>Confirm Password</b></label>
                    <div class="input-box">
                        <i class="ri-lock-password-line"></i>
                        <input type="password" id="confirm-password" name="confirm-password" placeholder="********" required>
                        <i class="ri-eye-line toggle-password"></i>
                    </div>
                </div>

                <button type="submit" class="next-btn" onclick="changePassword()">Change Password</button>
            </form>
        </div>

    </div>

    <script>
        async function changePassword() {
            event.preventDefault();

            let otp = document.getElementById("otp").value;
            let email = localStorage.getItem("forgot-email");
            let newPassword = document.getElementById("new-password").value;
            let confirmPassword = document.getElementById("confirm-password").value;
            let errorMessage = document.getElementById("errorMessage");

            if (newPassword !== confirmPassword) {
                errorMessage.textContent = "Passwords do not match";
                errorMessage.style.display = "block";
                return;
            } else {
                try {
                    let response = await fetch("https://active-fox-exactly.ngrok-free.app/ScholarZone/api/reviewer-forgot-password", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({ email, new_password: newPassword, otp })
                    });

                    let data = await response.json();

                    if (data.status === 201) {
                        alert("Password changed successfully. Please log in again.");
                        localStorage.removeItem("forgot-email");
                        window.location.href = "login.html";
                    } else {
                        alert(data.message);
                    }
                } catch (error) {
                    console.log(error);
                    alert("Please check your internet connection");
                }
            }
        }

        document.getElementById("menu-toggle").addEventListener("click", function () {
            document.getElementById("menu").classList.toggle("show");
        });
    </script>

</body>
</html>
