<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScholarZone Review</title>
    <link rel="stylesheet" href="../css/admin-reviewer2.css">
</head>
<body>
    <div class="sidebar">
      <div class="logo">
        <img src="../pictures/scholarzone-logo.png" class="close1" id="close1">
        <span class="logo-text">
            <span class="logo-scholar">Scholar</span><span class="logo-zone">Zone</span>
        </span>
    </div>
        <div class="nav-item">
            <a href="admin-dashboard.html" class="nav-link">
                <img src="../pictures/dashboard_icon.png" alt="Dashboard" class="nav-icon">
                Dashboard
            </a>
        </div>
        <div class="nav-item active">
            <a href="admin-reviewer1.html" class="nav-link">
                <img src="../pictures/review_icon.png" alt="Review" class="nav-icon">
                Reviewers
            </a>
        </div>
        <div class="nav-item">
            <a href="admin-applications1.html" class="nav-link">
                <img src="../pictures/manage_icon.png" alt="Application" class="nav-icon">
                Applications
            </a>
        </div>
    </div>

    <div class="main-content">
        <div class="header">
          <div class="menu-toggle">â˜°</div>
            <img src="../pictures/search_icon.png" alt="Search" class="searchocon">
            <input type="text" class="search-box" placeholder="Start typing">
            <div class="user-profile">
                <div class="username-container">
                  <span id="username">@admin</span>
                  <img src="../pictures/avatar-icon.png" alt="User" id="avatar-icon" class="avatar-icon" onclick="">
                  <img src="../pictures/bell-icon.png" alt="Bell" id="bell-icon" class="bell-icon">
                  <div class="hover-profile" id="hover-profile">
                      <ul>
                          <li><a href="#">Edit Profile Picture</a></li>
                          <li><a href="#" style="color: red;">Log Out</a></li>
                      </ul>
                  </div>
                </div>
            </div>
        </div>

        <div class="name">
          <h1 class="create-title">
              <img src="../pictures/review_icon.png" alt="Dashboard" class="nav-icon">
              Reviewers
          </h1>
        </div>

        <div class="content">
            <div class="back-button">
                <img src="../pictures/backbtn-icon.png" id="back-button">
            </div>

            <div class="forming">
            <div class="form-container">
              <div class="form-group">
                <label>First Name</label>
                <div class="input-container">
                  <input type="text" value="Jane" id="firstname" readonly>
                </div>
              </div>
              
              <div class="form-group">
                <label>School / Company</label>
                <div class="input-container">
                  <input type="text" value="PHINMA UPang" id="company" readonly>
                </div>
              </div>
              
              <div class="form-group">
                <label>Last Name</label>
                <div class="input-container">
                  <input type="text" value="Doe" id="lastname" readonly>
                </div>
              </div>
              
              <div class="form-group">
                <label>Phone Number</label>
                <div class="input-container">
                  <input type="text" value="+639123456789" id="phone" readonly>
                </div>
              </div>
              
              <div class="form-group">
                <label>Birthdate</label>
                <div class="input-container">
                  <input type="text" value="10/27/2004" id="birthdate" readonly>
                </div>
              </div>
              
              <div class="form-group">
                <label>Region, Province, City</label>
                <div class="input-container">
                  <input type="text" value="NCR, Manila, Marikina City" id="rpc" readonly>
                </div>
              </div>
              
              <div class="form-group">
                <label>Gender</label>
                <div class="input-container">
                  <input type="text" value="Male" id="gender" readonly>
                </div>
              </div>
              
              <div class="form-group">
                <label>Barangay, Street, Building</label>
                <div class="input-container">
                  <input type="text" value="Barangay V, Pantal St., Marikina buil" id="bsb" readonly>
                </div>
              </div>

              <div class="form-group ">
                <label>Company ID</label>
                <div class="input-container">
                  <input type="text" value="Open File" id="company_id" style="color: blue; cursor: pointer;" readonly>
                </div>
              </div>

              <div class="form-group ">
                <label>Certificate of Employment</label>
                <div class="input-container">
                  <input type="text" value="Open File" id="certificate" style="color: blue; cursor: pointer;" readonly>
                </div>
              </div>

              <div class="form-group ">
                <label>Authorization Letter</label>
                <div class="input-container">
                  <input type="text" value="Open File" id="authorization" style="color: blue; cursor: pointer;" readonly>
                </div>
              </div>

              <div class="form-group ">
                <label></label>
                <div class="input-container">
                  <input type="hidden" value="" id="n" readonly>
                </div>
              </div>

              <div class="action-buttons">
                <button class="approved-btn">Approve</button>
                <button class="rejected-btn">Reject</button>
            </div>
            </div>
            </div>
          </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", async function () {
          const menuToggle = document.querySelector('.menu-toggle');
          const mainContent = document.querySelector('.main-content');
          const sidebar = document.querySelector('.sidebar');
          const backBtn = document.querySelector('.back-button');
          const formContainer = document.querySelector('.form-container');
          const approvedBtn = document.querySelector('.approved-btn');
          const rejectedBtn = document.querySelector('.rejected-btn');
          const firstnameInput = document.getElementById('firstname');
          const lastnameInput = document.getElementById('lastname');
          const birthdateInput = document.getElementById('birthdate');
          const genderInput = document.getElementById('gender');
          const phoneInput = document.getElementById('phone');
          const companyInput = document.getElementById('company');
          const rpcInput = document.getElementById('rpc');
          const bsbInput = document.getElementById('bsb');
          const company_idInput = document.getElementById('company_id');
          const certificateInput = document.getElementById('certificate');
          const authorizationInput = document.getElementById('authorization');
          const bellBtn = document.getElementById('bell-icon');
          let token = localStorage.getItem('token');
          
          bellBtn.addEventListener('click', function() {
                window.location.href = 'admin-notifications.html';
          });

          menuToggle.addEventListener('click', () => {
              sidebar.classList.toggle('active');
              mainContent.classList.toggle('active');
          });

          backBtn.addEventListener('click', () => {
              window.history.back();
          });

          approvedBtn.addEventListener('click', async () => {
            console.log(localStorage.getItem('reviewer_id'));
            try {
                let response = await fetch(`http://localhost/ScholarZone/api/verify-reviewer`, {
                    method: "POST",
                    headers: {
                        "Content-type": "application/json",
                        "Authorization": `Bearer ${token}`,
                        "ngrok-skip-browser-warning": "true"
                    },
                    body: JSON.stringify({
                        reviewer_id: localStorage.getItem('reviewer_id')
                    })
                });

                let rawText = await response.text();
                console.log("Raw API Response:", rawText);

                let data;
                try {
                    data = JSON.parse(rawText);
                    console.log("Parsed API Response:", data);
                } catch (jsonError) {
                    console.error("JSON Parsing Error. API returned HTML or invalid JSON:", jsonError);
                    return;
                }

                if (data.status === 200) {
                    alert('Reviewer approved');
                    window.location.href = "admin-reviewer1.html";
                } else {
                    console.error("API returned error:", data.message);
                }
            } catch (error) {
                console.error("Fetch error:", error);
            }
          });

          rejectedBtn.addEventListener('click', () => {
              alert('Reviewer rejected');
              window.history.back();
          });

          let firstname = localStorage.getItem('reviewer_firstname');
          let lastname = localStorage.getItem('reviewer_lastname');
          let birthdate = localStorage.getItem('reviewer_birthdate');
          let gender = localStorage.getItem('reviewer_gender');
          let phone = localStorage.getItem('reviewer_phone');
          let company = localStorage.getItem('reviewer_company');
          let rpc = localStorage.getItem('reviewer_rpc');
          let bsb = localStorage.getItem('reviewer_bsb');
          let company_id = localStorage.getItem('reviewer_company_id');
          let certificate = localStorage.getItem('reviewer_certificate');
          let authorization = localStorage.getItem('reviewer_authorization');

          firstnameInput.value = firstname;
          lastnameInput.value = lastname;
          birthdateInput.value = birthdate;
          genderInput.value = gender;
          phoneInput.value = phone;
          companyInput.value = company;
          rpcInput.value = rpc;
          bsbInput.value = bsb;
          
          company_idInput.addEventListener('click', () => {
              window.open(company_id, '_blank');
          });

          certificateInput.addEventListener('click', () => {
              window.open(certificate, '_blank');
          });

          authorizationInput.addEventListener('click', () => {
              window.open(authorization, '_blank');
          });
          });

    </script>
</body>
</html>
